<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>逃げるゲーム</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #gameArea {
            position: relative;
            width: 90vw;
            height: 80vh;
            background-color: #fff;
            border: 3px solid #333;
            border-radius: 10px;
            overflow: hidden;
        }
        .player, .enemy, .goal {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }
        .player {
            background-color: #4CAF50;
        }
        .enemy {
            background-color: #F44336;
        }
        .goal {
            background-color: #FFD700;
        }
    </style>
</head>
<body>
    <div id="gameArea">
        <div class="player" id="player" style="top: 20px; left: 20px;"></div>
        <div class="enemy" id="enemy" style="top: 300px; left: 300px;"></div>
        <div class="goal" id="goal" style="top: 400px; left: 700px;"></div>
    </div>

    <script>
        const player = document.getElementById("player");
        const enemy = document.getElementById("enemy");
        const goal = document.getElementById("goal");
        const gameArea = document.getElementById("gameArea");
        let playerSpeed = 20;
        let enemySpeed = 2;
        let gameActive = true;

        // プレイヤーを動かす
        document.addEventListener("keydown", (e) => {
            if (!gameActive) return;
            let rect = player.getBoundingClientRect();
            let gameAreaRect = gameArea.getBoundingClientRect();

            switch (e.key) {
                case "ArrowUp":
                    if (rect.top > gameAreaRect.top) player.style.top = rect.top - gameAreaRect.top - playerSpeed + "px";
                    break;
                case "ArrowDown":
                    if (rect.bottom < gameAreaRect.bottom) player.style.top = rect.top - gameAreaRect.top + playerSpeed + "px";
                    break;
                case "ArrowLeft":
                    if (rect.left > gameAreaRect.left) player.style.left = rect.left - gameAreaRect.left - playerSpeed + "px";
                    break;
                case "ArrowRight":
                    if (rect.right < gameAreaRect.right) player.style.left = rect.left - gameAreaRect.left + playerSpeed + "px";
                    break;
            }

            checkCollision();
        });

        // 敵の移動
        function moveEnemy() {
            let playerRect = player.getBoundingClientRect();
            let enemyRect = enemy.getBoundingClientRect();

            let dx = playerRect.left - enemyRect.left;
            let dy = playerRect.top - enemyRect.top;
            let distance = Math.sqrt(dx * dx + dy * dy);

            if (distance > 1) {
                enemy.style.left = enemyRect.left + (dx / distance) * enemySpeed + "px";
                enemy.style.top = enemyRect.top + (dy / distance) * enemySpeed + "px";
            }

            checkCollision();
            if (gameActive) requestAnimationFrame(moveEnemy);
        }

        // ゴールと敵との当たり判定
        function checkCollision() {
            let playerRect = player.getBoundingClientRect();
            let goalRect = goal.getBoundingClientRect();
            let enemyRect = enemy.getBoundingClientRect();

            if (
                playerRect.left < goalRect.right &&
                playerRect.right > goalRect.left &&
                playerRect.top < goalRect.bottom &&
                playerRect.bottom > goalRect.top
            ) {
                alert("おめでとうございます！ゴールしました！");
                gameActive = false;
            }

            if (
                playerRect.left < enemyRect.right &&
                playerRect.right > enemyRect.left &&
                playerRect.top < enemyRect.bottom &&
                playerRect.bottom > enemyRect.top
            ) {
                alert("敵に捕まりました！ゲームオーバーです！");
                gameActive = false;
            }
        }

        moveEnemy();
    </script>
</body>
</html>
